#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export SWIFT_BUILD_DIR="${SWIFT_BUILD_DIR:-$ROOT_DIR/.build}"
export SWIFTPM_CACHE_PATH="${SWIFTPM_CACHE_PATH:-$ROOT_DIR/.swiftpm-cache}"
export SWIFT_USER_CONFIGURATION_DIRECTORY="${SWIFT_USER_CONFIGURATION_DIRECTORY:-$ROOT_DIR/.swiftpm-config}"
export CLANG_MODULE_CACHE_PATH="${CLANG_MODULE_CACHE_PATH:-$SWIFT_BUILD_DIR/ModuleCache}"

mkdir -p "$SWIFT_BUILD_DIR" "$SWIFTPM_CACHE_PATH" "$SWIFT_USER_CONFIGURATION_DIRECTORY" "$CLANG_MODULE_CACHE_PATH"

exec swift build "$@"
